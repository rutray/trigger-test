<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSSQL Trigger Master-Quiz</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f2f5; line-height: 1.6; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1a73e8; border-bottom: 2px solid #1a73e8; padding-bottom: 10px; }
        h2 { color: #2c3e50; margin-top: 30px; border-left: 5px solid #1a73e8; padding-left: 10px; }
        
        /* Code Box Styles */
        .code-exercise { background-color: #282c34; color: #abb2bf; padding: 20px; border-radius: 8px; font-family: 'Consolas', monospace; margin-bottom: 20px; position: relative; }
        .code-input { background: #3e4451; border: 1px solid #56b6c2; color: #61afef; padding: 4px; border-radius: 4px; width: 140px; text-align: center; font-weight: bold; }
        
        /* Question Styles */
        .question-block { margin-bottom: 25px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 8px; }
        .options { margin-left: 20px; }
        .option { display: block; margin-bottom: 8px; cursor: pointer; }
        
        .check-btn { background-color: #1a73e8; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; display: block; width: 100%; margin-top: 20px; }
        .check-btn:hover { background-color: #1557b0; }
        #final-result { margin-top: 30px; text-align: center; font-size: 20px; font-weight: bold; }
        .correct { color: #2ecc71; }
        .wrong { color: #e74c3c; }
    </style>
</head>
<body>

<div class="container">
    <h1>'MSSQL Trigger Master Of AP12' - Quiz </h1>

    <h2>Teil 1: Code-VervollstÃ¤ndigung (DML & DDL)</h2>

    <div class="question-block">
        <p><strong>1. DML Trigger:</strong> Protokolliere PreisÃ¤nderungen.</p>
        <div class="code-exercise">
            CREATE TRIGGER trg_PriceLog ON Products<br>
            <input type="text" class="code-input" data-ans="AFTER"> UPDATE AS<br>
            BEGIN<br>
            &nbsp;&nbsp;SET NOCOUNT ON;<br>
            &nbsp;&nbsp;INSERT INTO History(OldPrice, NewPrice)<br>
            &nbsp;&nbsp;SELECT d.Price, i.Price<br>
            &nbsp;&nbsp;FROM <input type="text" class="code-input" data-ans="deleted"> d<br>
            &nbsp;&nbsp;JOIN <input type="text" class="code-input" data-ans="inserted"> i ON d.ID = i.ID;<br>
            END;
        </div>
    </div>

    <div class="question-block">
        <p><strong>2. DML Trigger:</strong> Verhindere LÃ¶schen, setze Status auf 'Archiv'.</p>
        <div class="code-exercise">
            CREATE TRIGGER trg_SoftDelete ON Users<br>
            <input type="text" class="code-input" data-ans="INSTEAD OF"> DELETE AS<br>
            BEGIN<br>
            &nbsp;&nbsp;UPDATE Users SET Status = 'Archiv'<br>
            &nbsp;&nbsp;WHERE UserID IN (SELECT UserID FROM <input type="text" class="code-input" data-ans="deleted">);<br>
            END;
        </div>
    </div>

    <div class="question-block">
        <p><strong>3. DDL Trigger:</strong> Verhindere das LÃ¶schen von Tabellen.</p>
        <div class="code-exercise">
            CREATE TRIGGER trg_NoDrop ON <input type="text" class="code-input" data-ans="DATABASE"><br>
            AFTER <input type="text" class="code-input" data-ans="DROP_TABLE"> AS<br>
            BEGIN<br>
            &nbsp;&nbsp;PRINT 'Nicht erlaubt!';<br>
            &nbsp;&nbsp;<input type="text" class="code-input" data-ans="ROLLBACK">;<br>
            END;
        </div>
    </div>

    <div class="question-block">
        <p><strong>4. DDL Trigger:</strong> Ãœberwachung von neuen Datenbanken.</p>
        <div class="code-exercise">
            CREATE TRIGGER trg_ServerAudit ON <input type="text" class="code-input" data-ans="ALL SERVER"><br>
            AFTER CREATE_DATABASE AS<br>
            BEGIN<br>
            &nbsp;&nbsp;DECLARE @data XML = <input type="text" class="code-input" data-ans="EVENTDATA()">;<br>
            &nbsp;&nbsp;-- Logik folgt...<br>
            END;
        </div>
    </div>

    <h2>Teil 2: Wissenstest (Multiple Choice)</h2>

    <div id="mc-questions">
        </div>

    <button class="check-btn" onclick="validateQuiz()">Ergebnisse prÃ¼fen</button>
    <div id="final-result"></div>
</div>

<script>
    const mcData = [
        { q: "5. Welcher Trigger-Typ kennt 'FOR EACH ROW'?", a: "MySQL / PostgreSQL", o: ["MSSQL", "MySQL / PostgreSQL", "Beide"] },
        { q: "6. Was macht 'SET NOCOUNT ON'?", a: "UnterdrÃ¼ckt Statusmeldungen Ã¼ber betroffene Zeilen", o: ["UnterdrÃ¼ckt Statusmeldungen Ã¼ber betroffene Zeilen", "LÃ¶scht die Tabelle", "Beschleunigt nur DELETE"] },
        { q: "7. Welcher Befehl bricht eine Aktion im Trigger ab?", a: "ROLLBACK", o: ["STOP", "ABORT", "ROLLBACK"] },
        { q: "8. Was enthÃ¤lt die 'deleted'-Tabelle bei einem UPDATE?", a: "Den Zustand vor der Ã„nderung", o: ["Den Zustand vor der Ã„nderung", "Den Zustand nach der Ã„nderung", "Nichts"] },
        { q: "9. Wo werden LOGON-Trigger definiert?", a: "ON ALL SERVER", o: ["ON DATABASE", "ON TABLE", "ON ALL SERVER"] },
        { q: "10. Welches Format hat das Ergebnis von EVENTDATA()?", a: "XML", o: ["JSON", "XML", "CSV"] },
        { q: "11. Kann ein AFTER-Trigger eine Aktion verhindern?", a: "Ja, mittels ROLLBACK", o: ["Nein, es ist zu spÃ¤t", "Nur bei DELETE", "Ja, mittels ROLLBACK"] },
        { q: "12. Welcher Trigger fÃ¤ngt eine Aktion ab, BEVOR sie die Tabelle erreicht (MSSQL)?", a: "INSTEAD OF", o: ["BEFORE", "INSTEAD OF", "AFTER"] },
        { q: "13. Wie viele Zeilen kann die 'inserted'-Tabelle in MSSQL enthalten?", a: "Beliebig viele (abhÃ¤ngig vom Statement)", o: ["Immer nur eine", "Maximal 100", "Beliebig viele (abhÃ¤ngig vom Statement)"] },
        { q: "14. Was ist die Rettung, wenn ein LOGON-Trigger alle Admins aussperrt?", a: "DAC (Dedicated Administrator Connection)", o: ["Server neu starten", "DAC (Dedicated Administrator Connection)", "Passwort Ã¤ndern"] },
        { q: "15. Existieren 'inserted' und 'deleted' Tabellen in DDL-Triggern?", a: "Nein", o: ["Nein", "Ja" , "Nur bei DROP_TABLE"] }
    ];

    function loadMC() {
        const container = document.getElementById('mc-questions');
        mcData.forEach((d, i) => {
            let html = `<div class="question-block">
                <p><strong>${d.q}</strong></p>
                <div class="options">`;
            d.o.forEach(opt => {
                html += `<label class="option"><input type="radio" name="q${i}" value="${opt}"> ${opt}</label>`;
            });
            html += `</div></div>`;
            container.innerHTML += html;
        });
    }

    function validateQuiz() {
        let score = 21;
        let total = 21;

        // Code Gaps
        document.querySelectorAll('.code-input').forEach(input => {
            if (input.value.trim().toUpperCase() === input.dataset.ans.toUpperCase()) {
                input.style.borderColor = "#2ecc71";
                score++;
            } else {
                input.style.borderColor = "#e74c3c";
            }
        });

        // MC Questions
        mcData.forEach((d, i) => {
            const selected = document.querySelector(`input[name="q${i}"]:checked`);
            if (selected && selected.value === d.a) {
                score++;
            }
        });

        const resDiv = document.getElementById('final-result');
        resDiv.innerHTML = `Ergebnis: ${score} von ${total} richtig!`;
        if (score === total) {
            resDiv.className = "correct";
            document.body.style.backgroundColor = "#d4edda"; // Ein helles Erfolg-GrÃ¼n
	   resDiv.innerHTML += '<br>ðŸŽ‰ Du bist ein Trigger-Experte! ðŸŽ‰<br><br><img src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExcTY3anhnejgyenFib2IxYnIxYXp3bW5nNHFpNTZ5YXdtdnA4eThoZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/Hc8PMCBjo9BXa/giphy.gif" style="width:200px; border-radius:10px;">';
        } else {
            resDiv.className = "wrong";
            document.body.style.backgroundColor = "#f0f2f5"; // ZurÃ¼ck zur Standardfarbe, falls Fehler da sind
        }
        window.scrollTo(0, document.body.scrollHeight);
    }

    loadMC();
</script>

</body>
</html>